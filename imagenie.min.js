(function(){angular.module("imagenie",["LocalForageModule"]).constant("IMAGENIE_LOCAL_FORAGE_CONFIG",{name:"imagenie_db",storeName:"image",description:"The database to hold base 64 versions of all your images so they are available offline"}).factory("ImagenieUtil",["$q",function(c){return{getImageBase64String:function(a,f){var g=c.defer(),d=document.createElement("CANVAS"),h=d.getContext("2d"),b=new Image;b.crossOrigin="Anonymous";b.onload=function(){var a;d.height=b.height;d.width=b.width;h.drawImage(b,
0,0);a=d.toDataURL(f);d=null;g.resolve(a)};b.onerror=function(){g.reject(a)};b.src=a;return g.promise},isUndefined:function(a){return"undefined"===typeof a},isEmpty:function(a){return this.isUndefined(a)||""===a||null===a},getImageSrc:function(a){return this.isEmpty(a.imagenie)?this.isEmpty(a.ngSrc)?this.isEmpty(a.src)?this.isEmpty(a.defaultImg)?(console.warn("Image Src Undefined"),null):a.defaultImg:a.src:a.ngSrc:a.imagenie},setImageToElement:function(a,c){"IMG"===a[0].nodeName?a.attr("src",c):a.css("background-image",
"url("+c+")")},isUriAbsolute:function(a){return/^(?:[a-z]+:)?\/\//i.test(a)}}}]).directive("imagenie",["ImagenieUtil","$localForage","IMAGENIE_LOCAL_FORAGE_CONFIG",function(c,a,f){return{restrict:"A",link:function(g,d,h){h.$observe("imagenie",function(){var b=c.getImageSrc(h),e={};try{e=a.instance(f.name)}catch(g){if(ionic.Platform.isIOS())var k=angular.extend(f,{driver:"webSQLStorage"}),e=a.createInstance(k);else e=a.createInstance(f)}c.isUriAbsolute(b)&&(h.ngSrc="",e.getItem(encodeURIComponent(b)).then(function(a){c.isEmpty(a)?
(a=angular.element("<img />"),a.bind("load",function(){c.getImageBase64String(b).then(function(a){e.setItem(encodeURIComponent(b),a);c.setImageToElement(d,a)})}),a.attr("src",b)):c.setImageToElement(d,a)},function(){var a=angular.element("<img />");a.bind("load",function(){c.getImageBase64String(b).then(function(a){e.setItem(encodeURIComponent(b),a);c.setImageToElement(d,a)})});a.attr("src",b)}))})}}}])})();